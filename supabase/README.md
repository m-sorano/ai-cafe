# Supabase データベース設定手順

このディレクトリには、生成AI相談室アプリケーションで使用するSupabaseデータベースの設定に必要なSQLスクリプトが含まれています。

## スキーマの適用方法

### 方法1: Supabase管理画面からSQLを実行

1. [Supabase](https://app.supabase.com/)にログインし、プロジェクトを選択します。
2. 左側のメニューから「SQL Editor」を選択します。
3. 「New Query」ボタンをクリックします。
4. `schema.sql`ファイルの内容をコピーして、エディタに貼り付けます。
5. 「Run」ボタンをクリックしてSQLを実行します。

### 方法2: Supabase CLIを使用（開発者向け）

1. Supabase CLIがインストールされていることを確認します。
   ```bash
   npm install -g supabase
   ```

2. プロジェクトのルートディレクトリで以下のコマンドを実行します。
   ```bash
   supabase login
   supabase link --project-ref <YOUR_PROJECT_REF>
   supabase db push
   ```

## テーブル構造

このスキーマには以下のテーブルが含まれています：

1. **profiles**: ユーザープロフィール情報
2. **posts**: 投稿内容
3. **comments**: 投稿へのコメント
4. **reactions**: 投稿へのリアクション（ラテアート）
5. **knowledge_cards**: AI豆知識カード
6. **blends**: 投稿カテゴリ（ブレンド）のマスターデータ
7. **latte_art_types**: リアクションで使用するラテアートの種類

## Row Level Security (RLS)

すべてのテーブルにはRow Level Security (RLS)が設定されており、適切なアクセス制御が行われます。主なポリシーは以下の通りです：

- 誰でも全テーブルのデータを**参照**できます
- 認証済みユーザーのみがデータを**作成**できます
- ユーザーは自分のデータのみを**更新**または**削除**できます

## 初期データ

`blends`テーブルと`latte_art_types`テーブルには初期データが挿入されます：

- **ブレンド**: 初心者向け、上級者向け、ビジネス向け、クリエイティブ向け、フリートーク
- **ラテアート**: ハート、リーフ、ロゼッタ、スワン、スマイル

## トリガー

以下のトリガーが設定されています：

1. 各テーブルの`updated_at`フィールドを自動更新するトリガー
2. 新規ユーザー登録時にプロフィールを自動作成するトリガー
